<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Real-time Weather Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --glass: rgba(255,255,255,.18);
      --blur: 10px;
    }
    body{
      font-family: 'Kanit', sans-serif;
      transition: background 700ms ease, color 300ms ease;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
      color: #fff;
      background: #ffd6a5; /* fallback สำหรับมือถือ */
    }
    /* ====== BACKGROUND THEMES ====== */
    .bg-sunny{
      background: 
        radial-gradient(80% 80% at 50% 20%, #FFE781 0%, rgba(255,231,129,0) 70%),
        linear-gradient(135deg, #ffbdd4 0%, #ffd6a5 45%, #fff1b8 100%);
    }
    .bg-rain{
      background: linear-gradient(160deg, #1a2a6c 0%, #1e3c72 50%, #2a5298 100%);
    }
    .bg-cloudy{
      background: linear-gradient(120deg, #4b4b6b 0%, #6b5b73 50%, #7a6f86 100%);
    }
    .bg-night{
      background: 
        radial-gradient(70% 70% at 50% 30%, rgba(148,187,233,.35) 0%, rgba(148,187,233,0) 70%),
        linear-gradient(180deg, #0b1026 0%, #121a3b 60%, #1b2358 100%);
    }
    .fx-layer{ position: fixed; inset: 0; pointer-events: none; z-index: -1; overflow: hidden; }
    .clouds{ opacity: .85; filter: drop-shadow(0 8px 12px rgba(0,0,0,.25)); }
    .cloud{
      position: absolute; width: var(--w, 220px); height: var(--h, 80px);
      background: rgba(255,255,255,.9); border-radius: 50px;
      animation: drift var(--speed, 80s) linear infinite;
    }
    .cloud:before, .cloud:after{
      content:""; position:absolute; background: rgba(255,255,255,.95);
      width:60%; height:120%; border-radius: 50%; top:-30%; left:10%;
      box-shadow: 80px 20px 0 10px rgba(255,255,255,.95);
    }
    @keyframes drift{ 0%{ transform: translateX(-30vw);} 100%{ transform: translateX(130vw);} }
    .layer-1 .cloud{ --speed: 90s; opacity:.9; }
    .layer-2 .cloud{ --speed: 70s; opacity:.8; }
    .layer-3 .cloud{ --speed: 55s; opacity:.75; }
    .rain{
      position: fixed; inset:0;
      background: repeating-linear-gradient(to bottom,
        rgba(255,255,255,.0) 0px, rgba(255,255,255,.0) 10px,
        rgba(255,255,255,.25) 11px, rgba(255,255,255,.25) 12px);
      mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%, #000 10%, #000 90%, rgba(0,0,0,0) 100%);
      animation: rainShift 700ms linear infinite; opacity: .55;
    }
    @keyframes rainShift{ 0%{ background-position: 0 0; } 100%{ background-position: 0 40px; } }
    .raindrop{
      position:absolute; width:1px; height:60px;
      background: linear-gradient(to bottom, rgba(255,255,255,.0), rgba(255,255,255,.7));
      animation: fall var(--t, 1.2s) linear infinite;
    }
    @keyframes fall{ 0%{ transform: translateY(-80px); opacity: 0; } 10%{ opacity: 1; } 100%{ transform: translateY(110vh); opacity: .2; } }
    .stars{ position: fixed; inset:0; overflow:hidden; }
    .star{
      position:absolute; width:2px; height:2px; border-radius:50%; background: white;
      opacity:.9; animation: twinkle var(--tw, 2.5s) ease-in-out infinite alternate;
      box-shadow: 0 0 6px rgba(255,255,255,.9);
    }
    @keyframes twinkle{ 0%{ opacity:.3; transform: scale(1);} 100%{ opacity:1; transform: scale(1.6);} }
    .card{
      backdrop-filter: blur(var(--blur)); background-color: var(--glass);
      border-radius: 1.5rem; padding: 1.25rem;
      box-shadow: 0 10px 30px rgba(0,0,0,.2), inset 0 0 0 1px rgba(255,255,255,.12);
    }
    .temp-glow{
      text-shadow: 0 0 12px rgba(255,255,255,.8), 0 0 28px rgba(255,255,255,.5), 0 0 54px rgba(255,255,200,.35);
    }
    .icon-glow{ filter: drop-shadow(0 0 10px rgba(255,255,255,.6)); }
  </style>
</head>
<body class="bg-sunny text-white p-4 flex flex-col justify-center items-center">

  <!-- เอฟเฟกต์พื้นหลัง -->
  <div class="fx-layer stars" id="starsLayer" style="display:none;"></div>
  <div class="fx-layer clouds" id="cloudsLayer" style="display:none;">
    <div class="layer-1"></div><div class="layer-2"></div><div class="layer-3"></div>
  </div>
  <div class="fx-layer rain" id="rainLayer" style="display:none;"></div>
  <div class="fx-layer" id="rainDropsLayer" style="display:none;"></div>

  <!-- เนื้อหา -->
  <div class="max-w-xl w-full mx-auto space-y-6 relative z-10">
    <div class="flex flex-col items-center text-center pt-8 pb-4">
      <div class="flex items-center gap-3">
        <span id="main-icon" class="text-5xl icon-glow">—</span>
        <h1 class="text-3xl md:text-4xl font-semibold mt-2">Bangkok, Thailand</h1>
      </div>
      <div class="flex items-center mt-3">
        <span class="text-7xl md:text-8xl font-extralight temp-glow leading-none" id="temp-value">--°C</span>
      </div>
      <p class="text-2xl opacity-95 mt-1 capitalize" id="weather-description">...</p>
    </div>
    <div class="card p-4">
      <h2 class="text-xl font-semibold mb-3">Hourly Forecast</h2>
      <div id="hourly-forecast-container" class="flex overflow-x-auto space-x-4 pb-2"></div>
    </div>
  </div>

  <script>
    const API_KEY = 'ccffd32214c3b336e740cd6b4c9cf5d0';
    const lat = '13.7563', lon = '100.5018';
    const cloudsLayer = document.getElementById('cloudsLayer');
    const rainLayer = document.getElementById('rainLayer');
    const rainDropsLayer = document.getElementById('rainDropsLayer');
    const starsLayer = document.getElementById('starsLayer');
    const mainIconEl = document.getElementById('main-icon');

    function getWeatherIcon(id){
      if(id>=200 && id<300) return '⛈️';
      if(id>=300 && id<600) return '🌧️';
      if(id>=600 && id<700) return '❄️';
      if(id===800) return '☀️';
      if(id>800) return '☁️';
      return '❓';
    }
    function classifyWeather(id){
      if(id>=200 && id<600) return 'rain';
      if(id===800) return 'sunny';
      if(id>800) return 'cloudy';
      return 'sunny';
    }
    function isNightBySys(sys){
      const now=Math.floor(Date.now()/1000);
      return !(now>sys.sunrise && now<sys.sunset);
    }
    function clearLayers(){
      cloudsLayer.style.display='none'; rainLayer.style.display='none';
      rainDropsLayer.style.display='none'; starsLayer.style.display='none';
      [...cloudsLayer.querySelectorAll('.cloud')].forEach(n=>n.remove());
      [...rainDropsLayer.querySelectorAll('.raindrop')].forEach(n=>n.remove());
      [...starsLayer.querySelectorAll('.star')].forEach(n=>n.remove());
    }
    function setBodyTheme(theme, night=false){
      document.body.classList.remove('bg-sunny','bg-rain','bg-cloudy','bg-night');
      if(night) document.body.classList.add('bg-night');
      else document.body.classList.add(theme==='rain'?'bg-rain':theme==='cloudy'?'bg-cloudy':'bg-sunny');
    }
    function spawnStars(count=100){
      starsLayer.style.display='block';
      for(let i=0;i<count;i++){
        const s=document.createElement('div'); s.className='star';
        s.style.left=Math.random()*window.innerWidth+'px';
        s.style.top=Math.random()*window.innerHeight+'px';
        starsLayer.appendChild(s);
      }
    }
    function updateFX(theme, night=false){
      clearLayers();
      if(night){ setBodyTheme(theme,true); spawnStars(); }
      else setBodyTheme(theme,false);
    }

    async function fetchWeatherData(){
      const url=`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`;
      const res=await fetch(url); const data=await res.json();
      document.getElementById('temp-value').textContent=`${data.main.temp.toFixed(0)}°C`;
      document.getElementById('weather-description').textContent=data.weather[0].description;
      const wId=data.weather[0].id; mainIconEl.textContent=getWeatherIcon(wId);
      updateFX(classifyWeather(wId),isNightBySys(data.sys));
    }
    fetchWeatherData(); setInterval(fetchWeatherData,60000);
  </script>
</body>
</html>
